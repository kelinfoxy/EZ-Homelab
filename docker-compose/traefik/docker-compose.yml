# Traefik Service for Remote Servers
# This standalone Traefik instance runs on remote servers to discover local containers
# and communicate with the core Traefik on the core server via Docker TLS

services:
  traefik:
    # Local Traefik instance for container discovery on this remote server
    image: traefik:v3
    container_name: traefik
    restart: unless-stopped
    command:
      - '--api.dashboard=true'
      - '--api.insecure=true'  # Allow API access on port 8080
      - '--providers.docker=true'
      - '--providers.docker.exposedbydefault=false'
      - '--providers.docker.network=traefik-network'
      - '--providers.file.directory=/dynamic'
      - '--providers.file.watch=true'
      - '--log.level=INFO'
      - '--accesslog=true'
      - '--entrypoints.web.address=:80'
      - '--entrypoints.websecure.address=:443'
    environment:
      - TZ=America/New_York
    ports:
      - '80:80'    # HTTP entrypoint
      - '443:443'  # HTTPS entrypoint
      - '8080:8080'  # Dashboard (optional, for debugging)
    volumes:
      - ./config:/config
      - ./dynamic:/dynamic
      - /var/run/docker.sock:/var/run/docker.sock:ro
    networks:
      - traefik-network
    labels:
      - 'homelab.category=infrastructure'
      - 'homelab.description=Local reverse proxy for container discovery'
      - 'traefik.enable=false'  # This Traefik doesn't route itself

networks:
  traefik-network:
    external: true
