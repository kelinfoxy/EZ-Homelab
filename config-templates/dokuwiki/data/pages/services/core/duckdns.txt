====== DuckDNS ======

DuckDNS is a free dynamic DNS service that automatically updates your domain's IP address. In the AI-Homelab, DuckDNS provides the domain name that Traefik uses for SSL certificates and service routing.

===== Overview =====

**Purpose:** Dynamic DNS service
**URL:** https://duckdns.org (external service)
**Authentication:** Token-based
**Deployment:** Automatic (core stack)
**Update Interval:** Every 5 minutes

===== Key Features =====

**Dynamic DNS:**
  * **Free service**: No cost for basic usage
  * **Multiple domains**: Support for multiple subdomains
  * **API integration**: RESTful API for updates
  * **IPv4/IPv6**: Support for both IP versions

**SSL Integration:**
  * **Wildcard certificates**: *.yourdomain.duckdns.org
  * **Let's Encrypt**: Automatic certificate generation
  * **DNS challenge**: Domain ownership verification
  * **Certificate renewal**: Automatic 90-day renewal

**Reliability:**
  * **High uptime**: 99.9%+ availability
  * **Global CDN**: Fast DNS resolution worldwide
  * **Redundant servers**: Multiple DNS servers
  * **Monitoring**: Service status monitoring

===== Configuration =====

**DuckDNS Account Setup:**
  1. Visit https://duckdns.org
  2. Create free account
  3. Choose domain name (your subdomain)
  4. Get API token from account settings

**Environment Variables:**
```bash
# Required
DOMAIN=yourdomain.duckdns.org
DUCKDNS_TOKEN=your-api-token

# Optional
DUCKDNS_SUBDOMAINS=subdomain1,subdomain2
```

**Container Configuration:**
```yaml
services:
  duckdns:
    image: lscr.io/linuxserver/duckdns:latest
    container_name: duckdns
    restart: unless-stopped
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=${TZ}
      - SUBDOMAINS=${DUCKDNS_SUBDOMAINS:-yourdomain}
      - TOKEN=${DUCKDNS_TOKEN}
    deploy:
      resources:
        limits:
          cpus: '0.1'
          memory: 64M
        reservations:
          cpus: '0.01'
          memory: 16M
```

===== How It Works =====

**DNS Update Process:**
  1. **IP Detection**: Container detects current public IP
  2. **API Call**: Sends update request to DuckDNS API
  3. **DNS Update**: DuckDNS updates DNS records
  4. **Propagation**: DNS changes propagate globally
  5. **Verification**: Container verifies update success

**Update Frequency:**
  * **Interval**: Every 5 minutes
  * **Trigger**: Container startup + periodic updates
  * **Condition**: IP address change detected
  * **Logging**: Update success/failure logging

**API Integration:**
```bash
# Manual update (for testing)
curl "https://www.duckdns.org/update?domains=yourdomain&token=your-token&ip="

# Check current IP
curl "https://www.duckdns.org/update?domains=yourdomain&token=your-token&verbose=1"
```

===== SSL Certificate Integration =====

**Traefik Configuration:**
```yaml
certificatesResolvers:
  letsencrypt:
    acme:
      email: your-email@example.com
      storage: /acme.json
      dnsChallenge:
        provider: duckdns
        delayBeforeCheck: 30
```

**Certificate Generation:**
  * **Challenge Type**: DNS-01
  * **Record**: `_acme-challenge.yourdomain.duckdns.org`
  * **Value**: Generated by Let's Encrypt
  * **TTL**: 60 seconds (temporary)

**Wildcard Certificate:**
  * **Domain**: `*.yourdomain.duckdns.org`
  * **Coverage**: All subdomains automatically
  * **Type**: ECDSA P-256
  * **Validity**: 90 days
  * **Renewal**: Automatic (30 days before expiry)

===== Monitoring & Troubleshooting =====

**Container Logs:**
```bash
# View DuckDNS logs
docker logs duckdns

# Follow logs in real-time
docker logs -f duckdns
```

**DNS Verification:**
```bash
# Check DNS resolution
nslookup yourdomain.duckdns.org

# Check TXT record (during certificate generation)
dig TXT _acme-challenge.yourdomain.duckdns.org

# Verify IP address
curl -s https://api.ipify.org
```

**Common Issues:**

**DNS Not Updating:**
```bash
# Check token validity
curl "https://www.duckdns.org/update?domains=yourdomain&token=wrong-token"

# Verify internet connectivity
ping -c 4 8.8.8.8

# Check container status
docker ps | grep duckdns
```

**SSL Certificate Issues:**
  * **Rate Limiting**: Let's Encrypt limits (20 certificates/week)
  * **DNS Propagation**: Wait 5-10 minutes after DNS update
  * **Token Issues**: Verify DuckDNS token is correct
  * **Port Forwarding**: Ensure 80/443 are forwarded

**Troubleshooting Steps:**
  1. **Check logs**: `docker logs duckdns`
  2. **Verify token**: Test API manually
  3. **Check IP**: Confirm current public IP
  4. **Test DNS**: Verify domain resolution
  5. **Restart container**: `docker restart duckdns`

===== Advanced Configuration =====

**Multiple Subdomains:**
```bash
# Environment variable
DUCKDNS_SUBDOMAINS=sub1,sub2,sub3

# Or in compose
environment:
  - SUBDOMAINS=sub1,sub2,sub3
```

**IPv6 Support:**
```bash
# Enable IPv6 updates
environment:
  - IPV6=1
```

**Custom Update Interval:**
```bash
# Modify container command
command: sh -c "while true; do /app/duckdns.sh; sleep 300; done"
# 300 seconds = 5 minutes (default)
```

===== Security Considerations =====

**Token Security:**
  * **Storage**: Environment variables (not in code)
  * **Access**: Limited to DuckDNS container only
  * **Rotation**: Regular token renewal
  * **Monitoring**: API usage monitoring

**DNS Security:**
  * **DNSSEC**: Not supported by DuckDNS
  * **Rate Limiting**: API call restrictions
  * **Monitoring**: DNS query logging
  * **Backup**: Secondary DNS provider consideration

===== Performance & Reliability =====

**Update Efficiency:**
  * **Conditional Updates**: Only when IP changes
  * **Fast API**: Quick response times
  * **Error Handling**: Retry logic for failures
  * **Logging**: Comprehensive update logging

**Global Distribution:**
  * **Anycast**: Multiple global DNS servers
  * **CDN**: Fast resolution worldwide
  * **Caching**: DNS record caching
  * **Redundancy**: Multiple server locations

===== Alternative DNS Providers =====

**If DuckDNS is insufficient:**

**Cloudflare:**
  * **Free tier**: 100,000 DNS queries/month
  * **API**: Full DNS management
  * **DNSSEC**: Supported
  * **Analytics**: Query statistics

**No-IP:**
  * **Free tier**: 30-day renewal requirement
  * **Multiple hosts**: Up to 3 free domains
  * **Client software**: Windows/Mac/Linux clients
  * **Groups**: Domain grouping

**Dynu:**
  * **Free tier**: 1 domain, 30-day renewal
  * **API**: RESTful API
  * **IPv6**: Supported
  * **Analytics**: Basic statistics

===== Migration Guide =====

**Switching DNS Providers:**
  1. **Register**: Create account with new provider
  2. **Configure**: Set up domain and get API token
  3. **Update**: Modify environment variables
  4. **Test**: Verify DNS resolution
  5. **SSL**: Update Traefik certificate resolver
  6. **Cleanup**: Remove old DuckDNS container

**Certificate Migration:**
  * **Backup**: Save acme.json file
  * **Update**: Change DNS provider in Traefik
  * **Renew**: Force certificate renewal
  * **Verify**: Test SSL certificate validity

===== Best Practices =====

**Domain Management:**
  * **Choose wisely**: Select available, memorable domain
  * **Documentation**: Record domain and token securely
  * **Backup**: Include DNS settings in backup
  * **Monitoring**: Monitor domain expiration

**SSL Management:**
  * **Wildcard**: Use for all subdomains
  * **Backup**: Regular acme.json backups
  * **Monitoring**: Certificate expiry alerts
  * **Testing**: Regular SSL validation

**Reliability:**
  * **Redundancy**: Consider secondary DNS
  * **Monitoring**: DNS and SSL health checks
  * **Updates**: Keep container updated
  * **Logging**: Monitor update success

DuckDNS provides the foundation for your homelab's domain name and SSL certificates, ensuring secure and reliable access to all your services.

**Next:** Learn about [[services:core:gluetun|Gluetun]] or explore [[architecture:networking|Network Architecture]].